<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciamento de Usuários</title>
    <script>
        const apiUrl = 'http://localhost:8080/usuarios'; // Substitua pela URL correta da sua API

        // Função para buscar todos os usuários
        async function fetchUsuarios() {
            const response = await fetch(`${apiUrl}/listar`);
            const usuarios = await response.json();
            const usuarioList = document.getElementById('usuarioList');
            usuarioList.innerHTML = '';
            usuarios.forEach(usuario => {
                usuarioList.innerHTML += `
                    <li>
                        ${usuario.nome} (${usuario.username}) - 
                        <button onclick="deleteUsuario(${usuario.idUser})">Deletar</button>
                        <button onclick="populateForm(${usuario.idUser}, '${usuario.username}', '${usuario.email}', '${usuario.nome}', '${usuario.cpf_cnpj}', '${usuario.telefone}', '${usuario.tipo}', '${usuario.descricaoPerfil}', '${usuario.fotoPerfil}')">Editar</button>
                    </li>
                `;
            });
        }

        // Função para criar um novo usuário
        async function createUsuario(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const usuario = Object.fromEntries(formData);

            const response = await fetch(`${apiUrl}/criar`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(usuario),
            });

            if (response.ok) {
                fetchUsuarios(); // Atualiza a lista de usuários
                event.target.reset(); // Limpa o formulário
            } else {
                alert('Erro ao criar usuário.');
            }
        }

        // Função para deletar um usuário
        async function deleteUsuario(id) {
            const response = await fetch(`${apiUrl}/remover/${id}`, {
                method: 'DELETE',
            });

            if (response.ok) {
                fetchUsuarios(); // Atualiza a lista de usuários
            } else {
                alert('Erro ao deletar usuário.');
            }
        }

        // Função para popular o formulário com dados do usuário para edição
        function populateForm(id, username, email, nome, cpf_cnpj, telefone, tipo, descricaoPerfil, fotoPerfil) {
            document.getElementById('usuarioId').value = id;
            document.getElementById('username').value = username;
            document.getElementById('email').value = email;
            document.getElementById('nome').value = nome;
            document.getElementById('cpf_cnpj').value = cpf_cnpj;
            document.getElementById('telefone').value = telefone;
            document.getElementById('tipo').value = tipo;
            document.getElementById('descricaoPerfil').value = descricaoPerfil;
            document.getElementById('fotoPerfil').value = fotoPerfil;
        }

        // Função para atualizar um usuário
        async function updateUsuario(event) {
            event.preventDefault();
            const id = document.getElementById('usuarioId').value;
            const formData = new FormData(event.target);
            const usuario = Object.fromEntries(formData);

            const response = await fetch(`${apiUrl}/atualizar/${id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(usuario),
            });

            if (response.ok) {
                fetchUsuarios(); // Atualiza a lista de usuários
                event.target.reset(); // Limpa o formulário
                document.getElementById('usuarioId').value = ''; // Reseta o ID
            } else {
                alert('Erro ao atualizar usuário.');
            }
        }

        // Carrega a lista de usuários quando a página é carregada
        window.onload = fetchUsuarios;
    </script>
</head>
<body>
    <h1>Gerenciamento de Usuários</h1>

    <h2>Criar/Atualizar Usuário</h2>
    <form onsubmit="if (document.getElementById('usuarioId').value) { updateUsuario(event); } else { createUsuario(event); }">
        <input type="hidden" id="usuarioId" value="">
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" required><br>
        <label for="senha">Senha:</label>
        <input type="password" id="senha" name="senha" required><br>
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required><br>
        <label for="nome">Nome:</label>
        <input type="text" id="nome" name="nome" required><br>
        <label for="cpf_cnpj">CPF/CNPJ:</label>
        <input type="text" id="cpf_cnpj" name="cpf_cnpj" required><br>
        <label for="telefone">Telefone:</label>
        <input type="text" id="telefone" name="telefone"><br>
        <label for="tipo">Tipo:</label>
        <input type="text" id="tipo" name="tipo"><br>
        <label for="descricaoPerfil">Descrição do Perfil:</label>
        <input type="text" id="descricaoPerfil" name="descricaoPerfil"><br>
        <label for="fotoPerfil">Foto do Perfil:</label>
        <input type="text" id="fotoPerfil" name="fotoPerfil"><br>
        <button type="submit">Salvar Usuário</button>
    </form>

    <h2>Lista de Usuários</h2>
    <ul id="usuarioList"></ul>
</body>
</html>

